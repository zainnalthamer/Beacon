{% extends 'base.html' %}
{% block content %}
  <style>
    .page {
      max-width: 960px;
      margin: 0 auto;
      padding: 3rem 2rem 5rem;
      font-family: 'Inter', 'Segoe UI', sans-serif;
      margin-top: -35px;
    }
    
    .submission-header h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.4rem;
    }
    
    .submission-header .submitted-by {
      font-size: 0.95rem;
      color: #666666;
      font-weight: 500;
      margin-bottom: 2rem;
    }
    
    .section-title {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      font-size: 1.6rem;
      font-weight: 700;
      margin: 3rem 0 1.5rem;
    }
    
    .section-title::before {
      content: '';
      width: 6px;
      height: 28px;
      background: #d10000;
      border-radius: 3px;
      box-shadow: 0 0 0 1px rgba(209, 0, 0, 0.08);
    }
    
    .submission-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1rem;
      margin-bottom: 0.5rem;
    }
    
    .meta-item {
      background: #ffffff;
      border: 1px solid #e6e6e6;
      border-radius: 0.8rem;
      padding: 0.9rem 1rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      min-width: 0;
    }
    
    .meta-label {
      font-size: 0.78rem;
      letter-spacing: 0.02em;
      text-transform: uppercase;
      color: #666666;
      font-weight: 700;
    }
    
    .meta-value {
      font-size: 0.98rem;
      color: #111111;
      line-height: 1.5;
      min-width: 0;
    }
    
    .meta-link {
      display: block;
      max-width: 100%;
      padding: 0.42rem 0.6rem;
      border: 1px dashed #cccccc;
      border-radius: 0.5rem;
      background: #f9f9f9;
      color: #d10000;
      font-weight: 600;
      font-size: 0.9rem;
      text-decoration: none;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease;
    }
    
    .meta-link:hover {
      background: #f1f1f1;
      border-color: #aaaaaa;
      text-decoration: underline;
      color: #bb0000;
    }
    
    .button-red {
      display: inline-block;
      background: #d10000;
      color: #ffffff;
      font-weight: 600;
      padding: 0.6rem 1.4rem;
      border: none;
      border-radius: 0.6rem;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.15s ease;
      margin-top: 2rem;
    }
    
    .button-red:hover {
      background: #bb0000;
      transform: translateY(-1px);
    }
    
    .feedback-card {
      background: #fafafa;
      border: 1px solid #e3e3e3;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }
    
    .feedback-meta {
      font-size: 0.85rem;
      color: #666666;
      margin-top: 0.5rem;
    }
    
    .feedback-form {
      margin-top: 2rem;
    }
    
    .feedback-form textarea {
      width: 100%;
      min-height: 85px;
      max-height: 85px;
      max-width: 58rem;
      border: 1px solid #e1e1e1;
      border-radius: 0.6rem;
      padding: 0.8rem 1rem;
      font-size: 0.95rem;
      font-family: inherit;
      background: #ffffff;
      resize: none;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }
    
    .feedback-form textarea:focus {
      border-color: #d10000;
      box-shadow: 0 0 0 3px rgba(209, 0, 0, 0.08);
      outline: none;
    }
    
    .feedback-form button {
      margin-top: 1.5rem;
      background: #d10000;
      color: #fff;
      font-weight: 600;
      border: none;
      padding: 0.6rem 1.4rem;
      border-radius: 0.6rem;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.15s ease;
    }
    
    .feedback-form button:hover {
      background: #bb0000;
      transform: translateY(-1px);
    }
  </style>

  <div class="page">
    <div class="submission-header">
      <h1>{{ submission.assignment.title }}</h1>
      <p class="submitted-by">Submitted by {{ submission.student.username }}</p>
    </div>

    <div class="submission-meta">
      <div class="meta-item">
        <div class="meta-label">GitHub Repo</div>
        <div class="meta-value">
          {% if submission.repo_url %}
            <a class="meta-link" href="{{ submission.repo_url }}" target="_blank" rel="noopener noreferrer" title="{{ submission.repo_url }}">{{ submission.repo_url }}</a>
          {% else %}
            <span style="color:#777777;">Not provided</span>
          {% endif %}
        </div>
      </div>

      <div class="meta-item">
        <div class="meta-label">Live URL</div>
        <div class="meta-value">
          {% if submission.live_url %}
            <a class="meta-link" href="{{ submission.live_url }}" target="_blank" rel="noopener noreferrer" title="{{ submission.live_url }}">{{ submission.live_url }}</a>
          {% else %}
            <span style="color:#777777;">Not provided</span>
          {% endif %}
        </div>
      </div>

      <div class="meta-item">
        <div class="meta-label">Win</div>
        <div class="meta-value">{{ submission.win }}</div>
      </div>

      <div class="meta-item">
        <div class="meta-label">Challenge</div>
        <div class="meta-value">{{ submission.challenge }}</div>
      </div>

      <div class="meta-item">
        <div class="meta-label">Assistance</div>
        <div class="meta-value">{{ submission.assistance }}</div>
      </div>
    </div>
    <!-- end updated submission-meta -->

    {% if user.pk == submission.student.pk %}
      <form action="{% url 'delete_submission' submission.pk %}" method="post">
        {% csrf_token %}
        <button type="submit" class="button-red">ðŸ—‘ Remove Submission</button>
      </form>
    {% endif %}

    <div class="section-title">Feedback</div>

    {% if feedback %}
      <div class="feedback-card">
        <p>{{ feedback.comments }}</p>
        <p class="feedback-meta">By {{ feedback.instructor.username }} on {{ feedback.given_at|date:'F j, Y, g:i a' }}</p>
      </div>
    {% else %}
      <p>No feedback yet.</p>
    {% endif %}

    {% if form %}
      <form method="post" class="feedback-form">
        {% csrf_token %}
        {{ form.comments }}
        <button type="submit">Add Feedback</button>
      </form>
    {% endif %}
  </div>
{% endblock %}
